"""
Блок 4: Статистика и АБ-тесты
Задание 1: Воодушевленное руководство
Вы – аналитик компании Самокат (сервис по доставке продуктов на дом).
Команда решила протестировать гениальную идею замены транспортного средства доставщиков
и провели АБ эксперимент в небольшом городке РФ. Результаты превзошли все ожидания:
время доставки значимо снизилось в несколько раз! Руководству не терпится применить
изменения по всей стране.
Делаем? Выберите все верные утверждения:

а. Делаем. Только применяем изменения в таком же масштабе (количество транспортных средств
   с изменением), как в городе, где проводили тест.
б. Тест нерепрезентативен, поэтому результаты применять по всей стране нельзя.
с. Тест репрезентативен относительно своей генеральной совокупности: таких же небольших городов,
   можем применять только в подобных городах.
д. Наличие эффекта подтвердило потенциал идеи, поэтому сразу применять по всем городам не будем,
   но можем провести эксперимент в других городах.

Ключевые моменты:
- АБ-тест проведен в одном небольшом городке РФ
- Результаты значимы и положительны
- Руководство хочет применить изменения по всей стране

Принципы АБ-тестирования:
1. Репрезентативность выборки — это свойство выборочной совокупности, которое заключается в близости её характеристик 
к соответствующим характеристикам генеральной совокупности, из которой отобрана выборка. 
2. Масштабирование результатов — это преобразование данных в стандартизированную или нормализованную форму,
чтобы они были сопоставимы для анализа.
3. Валидность эксперимента — это мера соответствия методик и результатов исследования поставленным задачам.

Рассмотрим утверждения:
1. "Делаем. Только применяем изменения в таком же масштабе, как в городе, где проводили тест."
   - Масштаб применения не определяет репрезентативность.
   - Небольшой городок не репрезентативен для всей страны (разные условия, инфраструктура, плотность населения)
     НЕВЕРНО
2. "Тест нерепрезентативен, поэтому результаты применять по всей стране нельзя."
   - Тест нерепрезентативен для всей страны.
   - Но результаты можно применять с осторожностью в похожих условиях.
     ЧАСТИЧНО ВЕРНО
3. "Тест репрезентативен относительно своей генеральной совокупности: таких же небольших городов,
    можем применять только в подобных городах."
   - Это правильный подход к анализу результатов АБ-теста.
   - Результаты валидны для генеральной совокупности, на которую похож выбранный городок.
     ВЕРНО
4. "Наличие эффекта подтвердило потенциал идеи, поэтому сразу применять по всем городам не стоит,
    нужно провести эксперимент в других городах."
   - Это правильный подход - валидация в других условиях перед масштабированием.
   - Постепенное расширение тестирования снижает риски.
     ВЕРНО
ПРАВИЛЬНЫЕ ОТВЕТЫ: 3 и 4
"""
# Ответ
correct_answers = [3, 4]

print("=" * 80)
print("АНАЛИЗ ЗАДАНИЯ: Воодушевленное руководство")
print("=" * 80)
print("\nПравильные утверждения: 3 и 4\n")

print("Обоснование:")
print("- Утверждение 3: Тест репрезентативен для небольших городов, похожих на тестовый.")
print("  Результаты можно применять в подобных условиях.")
print("\n- Утверждение 4: Наличие эффекта подтверждает потенциал идеи.")
print("  Правильный подход - провести дополнительные эксперименты в других городах")
print("  перед масштабированием по всей стране.")
print("\n- Утверждение 1: НЕВЕРНО - масштаб не определяет репрезентативность.")
print("- Утверждение 2: ЧАСТИЧНО ВЕРНО, но слишком категорично.")

print(f"\nОТВЕТ: Правильные утверждения - {correct_answers}")

"""
check
АНАЛИЗ ЗАДАНИЯ: Воодушевленное руководство
================================================================================

Правильные утверждения: 3 и 4

Обоснование:
- Утверждение 3: Тест репрезентативен для небольших городов, похожих на тестовый.
  Результаты можно применять в подобных условиях.

- Утверждение 4: Наличие эффекта подтверждает потенциал идеи.
  Правильный подход - провести дополнительные эксперименты в других городах
  перед масштабированием по всей стране.

- Утверждение 1: НЕВЕРНО - масштаб не определяет репрезентативность.
- Утверждение 2: ЧАСТИЧНО ВЕРНО, но слишком категорично.

ОТВЕТ: Правильные утверждения - [3, 4]
"""

"""
Задание 2: Основной показатель в статистике

Что такое p-value в статистическом тестировании? Выберите одно верное утверждение:

1. Вероятность, что нулевая гипотеза верна.
2. Вероятность наблюдения такого или более экстремального результата при условии,
   что нулевая гипотеза верна.
3. Значение уровня значимости, при котором отвергается нулевая гипотеза.
4. Среднее значение выборки.
"""

"""
Определение P-VALUE:

P-value (p-значение) — это вероятность получить наблюдаемый или более экстремальный результат при условии, что нулевая гипотеза верна.

Ключевые моменты:
- P-value НЕ является вероятностью того, что нулевая гипотеза верна
- P-value вычисляется при предположении, что H0 верна
- Меньший p-value указывает на более сильные доказательства против H0
- Обычно сравнивают с уровнем значимости α (например, 0.05)
Примечание:H0 - нулевая гипотеза

Рассмотрим утверждения:

1. "Вероятность, что нулевая гипотеза верна."
   - Это распространенное заблуждение.
   - P-value не говорит о вероятности истинности гипотезы.
   - Это условная вероятность данных при условии истинности H0.
  НЕВЕРНО
2. "Вероятность наблюдения такого или более экстремального результата при условии,
    что нулевая гипотеза верна."
   - Это верное определение P-value.
   - P-value = P(данные | H0 верна)
     ВЕРНО
3. "Значение уровня значимости, при котором отвергается нулевая гипотеза."
   - Это описание уровня значимости α, а не P-value.
   - Уровень значимости выбирается заранее (обычно 0.05).
   - P-value сравнивается с α при принятии решения.
     НЕВЕРНО
4. "Среднее значение выборки."
   - Это не имеет отношения к P-value.
   - Среднее значение выборки - это арифметическое среднее всех элементов выборки
     НЕВЕРНО

ПРАВИЛЬНЫЙ ОТВЕТ: 2
"""
# Ответ
correct_answer = 2

print("=" * 80)
print("ОПРЕДЕЛЕНИЕ P-VALUE")
print("=" * 80)
print("\nP-value - это вероятность наблюдения такого или более экстремального")
print("результата при условии, что нулевая гипотеза верна.\n")

print("Ключевые моменты:")
print("- P-value НЕ является вероятностью того, что H0 верна")
print("- P-value = P(данные | H0 верна)")
print("- Меньший p-value = более сильные доказательства против H0")
print("- Обычно сравнивается с уровнем значимости α (например, 0.05)\n")

print(f"ПРАВИЛЬНЫЙ ОТВЕТ: {correct_answer}")
print("\nУтверждение 2 - точное определение p-value в статировании.")

"""
check
ОПРЕДЕЛЕНИЕ P-VALUE
================================================================================

P-value - это вероятность наблюдения такого или более экстремального
результата при условии, что нулевая гипотеза верна.

Ключевые моменты:
- P-value НЕ является вероятностью того, что H0 верна
- P-value = P(данные | H0 верна)
- Меньший p-value = более сильные доказательства против H0
- Обычно сравнивается с уровнем значимости α (например, 0.05)

ПРАВИЛЬНЫЙ ОТВЕТ: 2

Утверждение 2 - точное определение p-value в статировании.
"""

"""
Задание 3: Параметрический тест

Вам необходимо провести аб-тестирование, целевая метрика - среднее число уникальных покупок
на пользователя. Размер выборки велик (более 5 млн наблюдений в группах теста и контроля),
значительные выбросы в выборках отсутствуют.

Можем ли мы применить t-критерий Стьюдента для проверки гипотезы о неравенстве средних
в тестовой и контрольной группах при условии, что распределение уникальных покупок
является логнормальным?

Условия применения t-критерия Стьюдента:
1. Независимость наблюдений
2. Нормальность распределения (или достаточно большая выборка для ЦПТ)
3. Равенство дисперсий (для двухвыборочного t-теста)

Ключевые моменты задания:
- Размер выборки: > 5 млн наблюдений в каждой группе
- Распределение: логнормальное
- Выбросы: отсутствуют

Рассмотрим утверждения:

1. Центральная предельная теорема (ЦПТ):
   - При больших выборках (n > 30 обычно достаточно, здесь > 5 млн)
   - Распределение выборочного среднего стремится к нормальному
   - Даже если исходное распределение не нормальное
     t-критерий можно применять
2. Логнормальное распределение:
   - Если X ~ LogNormal, то log(X) ~ Normal
   - Для больших выборок среднее X будет приблизительно нормальным (по ЦПТ)
     t-критерий можно применять

3. Размер выборки:
   - 5 млн наблюдений - это очень большая выборка
   - ЦПТ гарантирует нормальность выборочного среднего
     t-критерий будет работать хорошо

Вывод:
ДА, можем применить t-критерий Стьюдента, потому что:
1. Размер выборки очень большой (> 5 млн) - ЦПТ гарантирует нормальность выборочного среднего
2. Логнормальное распределение не является препятствием при больших выборках
3. Отсутствие выбросов дополнительно поддерживает применение t-критерия

"""

# Ответ
answer = "ДА"

print("=" * 80)
print("ПРИМЕНИМОСТЬ T-КРИТЕРИЯ СТЬЮДЕНТА ДЛЯ ЛОГНОРМАЛЬНОГО РАСПРЕДЕЛЕНИЯ")
print("=" * 80)

print("\nУсловия задачи:")
print("- Размер выборки: > 5 млн наблюдений в каждой группе")
print("- Распределение: логнормальное")
print("- Выбросы: отсутствуют\n")

print("АНАЛИЗ:")
print("1. Центральная предельная теорема (ЦПТ):")
print("   - При больших выборках распределение выборочного среднего")
print("     стремится к нормальному, даже если исходное распределение не нормальное")
print("   - 5 млн наблюдений - более чем достаточно для применения ЦПТ\n")

print("2. Логнормальное распределение:")
print("   - Не является препятствием при больших выборках")
print("   - Выборочное среднее будет приблизительно нормальным\n")

print("3. Размер выборки:")
print("   - Очень большая выборка гарантирует нормальность выборочного среднего")
print("   - T-критерий будет работать корректно\n")

print("=" * 80)
print(f"ОТВЕТ: {answer}")
print("=" * 80)
print("\nМожем применить t-критерий Стьюдента, потому что:")
print("- Большой размер выборки (> 5 млн) гарантирует нормальность выборочного среднего")
print("- Логнормальное распределение не препятствует применению t-критерия при больших n")
print("- Отсутствие выбросов дополнительно поддерживает применение параметрического теста")
print("\nАльтернатива (опционально): можно применить логарифмическое преобразование,")
print("но это не обязательно при таких больших выборках.")

"""
check
ПРИМЕНИМОСТЬ T-КРИТЕРИЯ СТЬЮДЕНТА ДЛЯ ЛОГНОРМАЛЬНОГО РАСПРЕДЕЛЕНИЯ
================================================================================

Условия задачи:
- Размер выборки: > 5 млн наблюдений в каждой группе
- Распределение: логнормальное
- Выбросы: отсутствуют

АНАЛИЗ:
1. Центральная предельная теорема (ЦПТ):
   - При больших выборках распределение выборочного среднего
     стремится к нормальному, даже если исходное распределение не нормальное
   - 5 млн наблюдений - более чем достаточно для применения ЦПТ

2. Логнормальное распределение:
   - Не является препятствием при больших выборках
   - Выборочное среднее будет приблизительно нормальным

3. Размер выборки:
   - Очень большая выборка гарантирует нормальность выборочного среднего
   - T-критерий будет работать корректно

================================================================================
ОТВЕТ: ДА
================================================================================

Можем применить t-критерий Стьюдента, потому что:
- Большой размер выборки (> 5 млн) гарантирует нормальность выборочного среднего
- Логнормальное распределение не препятствует применению t-критерия при больших n
- Отсутствие выбросов дополнительно поддерживает применение параметрического теста

Альтернатива (опционально): можно применить логарифмическое преобразование,
но это не обязательно при таких больших выборках.
"""
